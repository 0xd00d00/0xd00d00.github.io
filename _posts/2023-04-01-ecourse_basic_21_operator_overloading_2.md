---
layout: post
author: λ„λ‘
title: "[C++ Basic] μ¤λ§νΈ ν¬μΈν„° (μ°λ¨Ήλ²„μ „)"
subtitle: "μ¤λ§νΈ ν¬μΈν„°μ κΈ°μ΄μ  λ¶€λ¶„μ„ λ§λ“¤μ–΄λ³΄λ©° μ΄ν•΄ν•΄λ³΄μπ"
date: 2023-04-01
cover: /assets/img/default.png
tags: C++ Cpp_Basic
sitemap :
 changefreq : daily
 priority : 1.0
---
μ•λ…•ν•μ„Έμ”! λ‘λ‘μ½”λ”© <span class="doodoo">λ„λ‘ π¥Έ</span> μ…λ‹λ‹¤ β‹ <br>
μ¤λμ€ C++ μ¤λ§νΈ ν¬μΈν„° κ°λ…μ— λ€ν•΄ μ•μ•„λ³΄κ² μµλ‹λ‹¤.

π–‡ μ†μ¤μ½”λ“μ— λ§μ°μ¤λ¥Ό μ¬λ¦¬κ³  <span class="tip">copy</span> λ²„νΌμ„ λ„λ¥Ό κ²½μ° λ” μ‰½κ² λ³µμ‚¬ν•  μ μμµλ‹λ‹¤!

κ¶κΈν• μ , λ³΄μ•μ  λ‚¨κ²¨μ£Όμ‹λ©΄ μ„±μ‹¤ν λ‹µλ³€ν•κ² μµλ‹λ‹¤. π <br>
\+ κ°μƒν‰ λ“κΈ€λ΅ λ‚¨κ²¨μ£Όμ‹λ©΄ νμ΄λ©λ‹λ‹¤. π™‡ <br>
### Intro.
μ΄λ² ν¬μ¤ν…μ—μ„λ” *μ¤λ§νΈν¬μΈν„°* λ¥Ό μ•μ•„λ³΄κ² μµλ‹λ‹¤.

### μ¤λ§νΈν¬μΈν„°μ λ“±μ¥
μ¤λ§νΈν¬μΈν„°λ” C++μ—μ„ μ‚¬μ©ν•λ” κ°λ…μΌλ΅ κ°€λΉ„μ§€μ»¬λ™ν„°κ°€ μ—†λ” C++μ λ©”λ¨λ¦¬ νμ μ •μ±…μ„ λ„μ™€μ£Όλ” μ•„μ£Ό μ μ©ν• λ„κµ¬μ΄λ‹¤.

ν•΄λ‹Ή ν¬μΈν„°λ¥Ό λ§λ“¤μ–΄λ³΄λ©° μ°λ¨Ή(?)μ •λ„ ν•΄λ³΄λ„λ΅ ν•μ. λ„λ¬΄ κΉκ² λ“¤μ–΄κ°€λ©΄ μ–΄λ ¤μ΄ λ¶€λ¶„μ΄ λ§μ•„ κΉμ€ λ¶€λ¶„μ€ μ¤‘κΈ‰ / κ³ κΈ‰ κ³Όμ •μ—μ„ λ‹¤λ£¬λ‹¤.

```cpp
#include <iostream>

class Car
{
public:
  void Go() { std::cout << "Go" << std::endl; }
  ~Car() { std::cout << "~Car" << std::endl; }
};

class Sptr
{
  Car* ptr;

public:
  Sptr(Car* p = 0) : ptr(p) {}

  Car* operator->() { return ptr; }
};

int main()
{
  Sptr p = new Car;

  p->Go();
}
```

μ„μ™€ κ°™μ€ μ½”λ“κ°€ μλ‹¤κ³  ν•μ. `Sptr`μ€ ν¬μΈν„°μ™€ κ°™μ€ ν•μ‹μΌλ΅ μ‚¬μ©λκ³  μλ‹¤. `p->GO();`λ¥Ό λ³΄λ©΄ ν¬μΈν„°μ—μ„ μ°λ¦¬κ°€ λ‚΄λ¶€ λ°μ΄ν„°μ— μ ‘κ·Όν•  λ• μ‚¬μ©ν•λ” μ—°μ‚°μ΄λ‹¤.

μƒκ°ν•΄λ³΄λ©΄ `Sptr`μ€ *κ°μ²΄μΈλ°.. μ–΄λ–»κ² μ €κ² κ°€λ¥ν•μ§€?* λΌκ³  μƒκ°ν•λ©΄ κ°€μ¥ λ¨Όμ € λ– μ¬λ ¤μ•Όν•  κ²ƒμ€ `->()` μ—°μ‚°μ μ¬μ •μμ•„λ‹κΉ? μ΄λ‹¤.

λ°”λ΅ `operator->()`μ μ¬μ •μμΈλ°, ν’€μ–΄μ„ μƒκ°ν•΄λ³΄λ©΄ λ‹¤μκ³Ό κ°™λ‹¤.

`(p.operator->())->Go();` μ—¬κΈ°μ„ `operator->()`μ νΉμ§•μ΄ λ‚μ¤λ”λ°, ν•΄λ‹Ή μ—°μ‚°μ μ¬μ •μλ¥Ό ν•  κ²½μ° `->`κ°€ ν•λ² λ” μλ” κ²ƒ μ²λΌ μ‚¬μ©λλ‹¤λ” μ μ΄λ‹¤.

μ¦‰, `operator->()`λ¥Ό ν–μ„ λ•, *ν¬μΈν„°λ¥Ό λ°ν™* λ°›λ”λ°, κ·Έ κ²½μ° β‚©`->`λ¥Ό ν†µν•΄ λ‚΄λ¶€ ν•¨μμ— μ ‘κ·Όμ„ ν•΄μ•Όν•λ‹¤. κ·Έλ΄κ²½μ° `Go()`λ¥Ό νΈμ¶ν•λ”κ² λκ² μ• λ§¤ν•΄μ§€λ”λ°, μ΄κ±΄ λ‚΄λ¶€μ μΌλ΅ λ°ν™λ°›μ€ ν¬μΈν„°κ°€ `->`λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ²λΌ λ³€ν™ν•΄μ¤€λ‹¤λ” κ²ƒμ΄λ‹¤.

μ¦‰, `operator->()`μ“°κ³  λ°ν™λ°›μ€ ν¬μΈν„°λ” `->`λ΅ λ‚΄λ¶€ μ ‘κ·Όν•λ‹¤λ§ κΈ°μ–µν•λ©΄ λλ‹¤.

μ„μ™€ κ°™μ΄ `Sptr`μ„ μ‚¬μ©ν•λ©΄ *ν¬μΈν„° μ²λΌ κ°μ²΄λ¥Ό μ‚¬μ©*ν•  μ μλ‹¤. κ°μ²΄μ‚¬μ©μ μ¥μ μ΄ μ¤‘μ”ν•λ°, λ°”λ΅ κ°μ²΄μ *μƒμ„± / λ³µμ‚¬ / λ€μ… / μ†λ©Έ* κ³Όμ •μ„ μ μ–΄ν•  μ μλ‹¤λ” μ μ΄λ‹¤.

νΉν *μ†λ©Έμ κ³Όμ •μ„ ν•λ² λ³΄λ„λ΅ ν•μ*

```cpp
class Sptr
{
  Car* ptr;

public:
  Sptr(Car* p = 0) : ptr(p) {}

  // μ†λ©Έμ
  ~Sptr() { delete ptr; }
  Car* operator->() { return ptr; }
};
```

μ„μ™€ κ°™μ΄ *μ†λ©Έμ*λ¥Ό ν™μ©ν•μ—¬, λ‚΄λ¶€ `ptr`μ„ μ κ±°ν•  μ μλ‹¤. λ¶„λ… μ„ `main()`μ—μ„λ” `delete` μ—°μ‚°μ„ ν•κ³  μμ§€ μ•λ”λ‹¤. ν•μ§€λ§ μ„ μ½”λ“λ¥Ό μ μ©ν•  κ²½μ° `main()`μ΄ λλ‚¨κ³Ό λ™μ‹, `Sptr`μ΄ νκ΄΄λκ³ , μ†λ©Έμκ°€ λ¶λ ¤ `ptr` λ°μ΄ν„°λ„ μ κ±°λ  κ²ƒμ΄λ‹¤.

μ¦‰, μ„ ν–‰μ„λ” λ³΄ν†µ *κ°€λΉ„μ§€ μ»¬λ™ν„°*κ°€ ν•΄μ£Όλ” μ—­ν• μΈλ°, μ΄μ™€ μ μ‚¬ν• λ¨μ–‘μ„ *κ°μ²΄ν™”*ν•λ‹¤λ©΄ λ‚νƒ€λ‚Ό μ μλ‹¤.

λ³΄ν†µ ν¬μΈν„°λΌκ³  ν•λ©΄ `->`μ—°μ‚°μ λ§κ³  `*`μ—­μ°Έμ΅° μ—°μ‚°λ„ λ§μ΄ ν™μ©ν•λ”λ°, κ·Έκ²ƒλν• μ¬μ •μκ°€ κ°€λ¥ν•λ‹¤.

```cpp
class Sptr
{
  Car* ptr;

public:
  Sptr(Car* p = 0) : ptr(p) {}

  // μ†λ©Έμ
  ~Sptr() { delete ptr; }
  Car* operator->() { return ptr; }

  // *operator μ—°μ‚°μ μ¬μ •μ
  Car& operator*() { return *ptr; }
};
```

μ„μ™€ κ°™μ΄, μ¬μ •μλ¥Ό ν•  κ²½μ° `(*p).Go()`μ™€ κ°™μ€ λ™μ‘μ„ ν•  μ μλ‹¤.

### μ¤λ§νΈν¬μΈν„° template ν™”
μ„μ—μ„ μ°λ¦¬κ°€ `Sptr`λ¥Ό λ§λ“¤λ©΄μ„ νΉμ • νƒ€μ… `Car`μ— λ€ν•΄ ν¬μΈν…ν•΄ κ°’μ„ μ ‘κ·Όν•λ„λ΅ λ§λ“¤μ—λ‹¤. `Sptr`κ°μ²΄λ¥Ό ν™μ©ν•΄ λ‹¤μ–‘ν• νƒ€μ…μ„ ν¬μΈν…ν•΄ μμ›κ΄€λ¦¬λ¥Ό ν•  μ μλ„λ΅ ν•κΈ° μ„ν•΄μ„λ” μ–΄λ–»κ² ν•΄μ•Όν• κΉ???

μ•μ—μ„ λ§μ΄ λ‹¤λ¤„μ„ μµμ™ν•κ² μ§λ‚, λ°”λ΅ *Template ν™”* ν•λ” κ²ƒμ΄λ‹¤.

```cpp
#include <iostream>

template<typename T> class Sptr
{
  // νƒ€μ…μ ν¬μΈν„°
  T* ptr;

public:
  Sptr(T* p = 0) : ptr(p) {}
  ~Sptr() { delete ptr; }

  T* operator->() { return ptr; }
  T& operator*()  { return &ptr; }
}

int main()
{
  Stpr<int> p1 = new int;

  *p1 = 10;
  std::cout << *p << std::endl;
}
```

μ„μ μ½”λ“μ™€ κ°™μ΄ λ§λ“¤ κ²½μ° *λ‹¤μ–‘ν• νƒ€μ…μ— λ€ν•΄μ„* μ¤λ§νΈ ν¬μΈν… ν•  μ μλ‹¤. μ¦‰, `int*`λ¥Ό λ§λ“¤μ–΄ μ‚¬μ©ν•μ§€λ§, `delete` μ—°μ‚° μ¦‰, μμ›λ„μν„μƒμ— λ€ν•΄ μƒκ°ν•  ν•„μ”κ°€ μ—†λ‹¤.

μ‚¬μ©λ°©λ²•μ€ μ•„μ£Ό κ°„λ‹¨ν•λ‹¤. μ¶”κ°€λ΅, μ£Όμμ‚¬ν•­μ„ μ•μ•„λ³΄μ.

*μ¤λ§νΈν¬μΈν„°*λ¥Ό λ§λ“¤ λ• μ£Όμν•  μ μ΄ ν•λ‚κ°€ μλ”λ° μ•„λμ μ½”λ“λ¥Ό λ³΄μ.

```cpp
int main()
{
  Sptr<int> p2 = p1;
}
```

μ„μ™€ κ°™μ΄ ν•  κ²½μ° *μ—λ¬κ°€ λ°μƒ*ν•λ‹¤. μ»΄νμΌ μ—λ¬μ΄λ©΄ μ½”λ“κ°€ μλ»λ λ¶€λ¶„μ„ μ°ΎμΌλ©΄ λλ”λ° μ•„μ‰½κ²λ„ *λ°νƒ€μ„ μ—λ¬*κ°€ λ°μƒν•λ‹¤. μ™ λ°μƒν•λ” κ²ƒμΌκΉ? λ°”λ΅ λ€μ…μ—°μ‚°μμ νΉμ§• *λ¨λ“  κ°’μ„ λ³µμ‚¬ν•¨ (λ‹¨, shallow copy)*μ λ¬Έμ μ΄λ‹¤.

λ€μ…μ—°μ‚°μ κ°™μ€ κ²½μ° shallow copy μ¦‰, bitwise μΉ΄ν”Όλ΅ ν¬μΈν„° μ£Όμ†κ°’λ„ κ·Έλƒ¥ λ³µμ‚¬ν•΄λ²„λ¦°λ‹¤. λ”°λΌμ„, ν¬μΈν… λ€μƒμ„ κ°€λ¦¬ν‚¤κ³  μλ” μ£Όμ†κ°’λ„ λ³µμ‚¬λκ³ , λ€μƒμ„ κ°€λ¦¬ν‚¤λ” ν¬μΈν„°λ” 2κ°κ°€ λλ‹¤. μ΄ κ²½μ° μ–΄λ–¤ ν•λ‚μ ν¬μΈν…μ—μ„ `delete`μ—°μ‚°μ„ ν•  κ²½μ°, λ€μƒκ°μ²΄κ°€ νκ΄΄λκΈ° λ•λ¬Έμ—, ν¬μΈν„° ν•λ‚κ°€ λ¶€μ ν•λ” λ¬Έμ κ°€ λ°μƒν•λ‹¤.

μ΄λ¥Ό λ§‰κΈ° μ„ν•΄ μ°λ¦¬λ” 2κ°€μ§€λ¥Ό μ•μ„ λ°°μ› λ‹¤.

*1. deep copy κµ¬ν„*

κ°€μ¥ λ¨Όμ € μƒκ°ν•  μ μλ” λ°©λ²•μ€ `Sptr`μ λ€μ…μ—°μ‚°μλ¥Ό `deep copy`λ¥Ό ν†µν•΄ κµ¬ν„ν•λ” κ²ƒμ΄λ‹¤. ν•μ§€λ§ *ν¬μΈν„°λΌλ” νΉμ„±*μƒ λ€μƒ κ°μ²΄λ¥Ό κ°€λ¦¬ν‚¤λ” μ—­ν• μ„ ν•΄μ•Όλλ”λ° *λ€μƒ κ°μ²΄λ¥Ό μƒλ΅­κ² λ§λ“λ”κ±΄* μ•„μ£Ό μ–΄νκ°€ μλ” ν–‰μ„μ΄λ‹¤.

λ”°λΌμ„ μ°λ¦¬λ” 2λ²μ§Έ λ°©λ²•μ„ ν™μ©ν•΄μ•Όν•λ‹¤.

*2. reference counting κµ¬ν„*

μ¦‰, ν„μ¬ *λ€μƒ κ°μ²΄λ¥Ό κ°€λ¦¬ν‚¤κ³  μλ” ν¬μΈν„°μ κ°―μλ¥Ό κ΄€λ¦¬*ν•λ” κΈ°λ²•μ„ μ‚¬μ©ν•΄μ•Όν•λ‹¤. μ΄ λ°©λ²•μ€ μ‚΄μ§ μ–΄λ ¤μ΄ λ¶€λ¶„μ΄ μμ–΄ *μ°λ¨Ή ν•λ” ν¬μ¤ν…*μ—μ„ λ‹¤λ£¨κΈ°λ³΄λ‹¤ μ¤‘κΈ‰κ³Όμ •μ—μ„ λ‹¤λ£¨λ„λ΅ ν•λ‹¤.

μ •λ¦¬ν•΄λ³΄μλ©΄, μ¤λ§νΈ ν¬μΈν„°μ λ€μ…μ—°μ‚°μμ—μ„λ” *referencing counter* λ°©λ²•μ„ ν™μ©ν•΄ λ€μƒκ°μ²΄κ°€ μ„μλ΅ νκ΄΄λλ” ν–‰μ„λ¥Ό λ§‰μ•„μ•Όν•λ‹¤λ” μ μ„ κΈ°μ–µν•μ.

μ•„.. λ€μ…μ—°μ‚°μλ” μ¬μ •μκ°€ κ°€λ¥ν• κΉ? => λ°”λ΅ [λ‹¤μ ν¬μ¤ν…]()μ—μ„ λ‹¤λ£¨λ„λ΅ ν•λ‹¤.

### ν‘μ¤€ μ¤λ§νΈν¬μΈν„°
μ°λ¦¬λ” μ¤λ§νΈν¬μΈν„°λ¥Ό κµ¬ν„ν•΄λ³΄λ©°, μμ›κ΄€λ¦¬λ¥Ό ν•΄μ£Όλ” μ¤λ§νΈν•¨μ— μ¥μ μ„ κΉ¨λ‹³μ•λ‹¤. ν•μ§€λ§, μ–΄λ–¤ ν”„λ΅κ·Έλ¨μ„ κ°λ°ν•  λ•λ§λ‹¤ μ°λ¦¬κ°€ λ§λ“¤μ–΄μ¨μ•Όν• κΉ? κ·Έκ±΄μ•„λ‹λ‹¤. λ°”λ΅ *C++ ν‘μ¤€μ—μ„ μ¤λ§νΈ ν¬μΈν„°λ¥Ό μ κ³µ*ν•΄μ£ΌκΈ° λ•λ¬Έμ—, ν•΄λ‹Ή κ°μ²΄λ¥Ό κ°€μ Έλ‹¤ μ“°λ©΄λλ‹¤.

```cpp
#include <iostream>
// μ¤λ§νΈν¬μΈν„°λ¥Ό μ‚¬μ©ν•κΈ° μ„ν• ν—¤λ”
#include <memory>

class Car{
public:
  void Go() { std::cout << "Go" << std::endl; }
  ~Car() { std::cout << "~Car" << std::endl; }
};

int main() {
  std::shared_ptr<Car> p (new Car); // ok..!!

  p->Go();
}
```

μ„μ™€ κ°™μ΄ C++ ν‘μ¤€μ—μ„λ” `<memory>` ν—¤λ”νμΌμ— μ¤λ§νΈν¬μΈν„°λ¥Ό λ§λ“¤μ–΄ μ κ³µν•λ‹¤. μ¤λ§νΈ ν¬μΈν„°μ μ΄λ¦„μ€ `shared_ptr`μ΄λ‹¤. ν•΄λ‹Ή κ°μ²΄λ” λ‚΄λ¶€μ μΌλ΅ *μ°Έμ΅°κ³„μ κΈ°λ° μ¦‰, referencing count* λ°©λ²•μ„ ν†µν•΄ κµ¬ν„λμ–΄μ Έ μλ‹¤.

μμ›κ΄€λ¦¬λ¥Ό λ”°λ΅ ν•κ³  μ‹¶μ§€ μ•λ‹¤λ©΄ ν¬μΈν„°λ¥Ό μ‚¬μ©ν•  λ• λ¬΄μ΅°κ±΄ *μ¤λ§νΈ ν¬μΈν„°λ¥Ό μ κ·Ή ν™μ©*ν•μ.

μ¶”κ°€λ΅, μ¤λ§νΈ ν¬μΈν„°λ¥Ό μ‚¬μ©ν•¨μ— μμ–΄ *μ£Όμμ‚¬ν•­μ΄ ν•κ°€μ§€ μλ‹¤*

```cpp
int main()
{ 
  std::shared<Car> p (new Car); // 1

  std::shared<Car> p = new Car; // 2 error
}
```

μ„μ™€ κ°™μ΄, *[1]* μ΄κΈ°ν™” κ°™μ€ κ²½μ° μ •μƒμ μΌλ΅ λ™μ‘ν•λ‹¤. ν•μ§€λ§ *[2]* μ΄κΈ°ν™” κ°™μ€ κ²½μ° μ—λ¬κ°€ λ°μƒν•λ”λ° μ΄λ” `explicit`κ°λ…κ³Ό *λ³€ν™μƒμ„±μ* κ°λ…μ„ μ•μ•„μ•Όν•κΈ° λ•λ¬Έμ— *μ°λ¨Ή κ³Όμ •*μ΄ μ•„λ‹ μ¤‘κΈ‰κ³Όμ •μ—μ„ μμ„Έν•κ² λ‹¤λ£¨λ„λ΅ ν•λ‹¤!

### Outtro.
ν•΄λ‹Ή ν¬μ¤ν…μ€ Ecourseμ C++ Basic κ°•μλ¥Ό μ°Έκ³ ν•΄ μ‘μ„±λμ—μµλ‹λ‹¤.

κ°•μλ¥Ό μ°Έκ³ ν•μ‹¤ λ¶„μ€ [μ—¬κΈ°](https://www.ecourse.co.kr/course/cppbasic_v2/)λ¥Ό ν΄λ¦­ν•΄ ν™•μΈν•΄μ£Όμ„Έμ”!
