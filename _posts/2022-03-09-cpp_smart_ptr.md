---
layout: post
author: doodoo
title: "[C++][Modern C++] μ¤λ§νΈν¬μΈν„° μ›λ¦¬"
subtitle: "C++ μ—μ„ μ‚¬μ©λλ” μ¤λ§νΈν¬μΈν„°μ μ›λ¦¬μ™€ ν•„μ”μ„±μ— λ€ν•΄ μ΄μ•ΌκΈ°ν•΄λ³΄μ π"
date: 2022-03-09
cover: /assets/img/default.png
tags: C++ Modern_C++
sitemap :
 changefreq : daily
 priority : 1.0
---
μ•λ…•ν•μ„Έμ”! <span class="doodoo">λ‘λ‘μ½”λ”©</span> μ…λ‹λ‹¤ β‹ <br>
μ¤λμ€ μ¤λ§νΈ ν¬μΈν„° μ›λ¦¬μ— λ€ν•΄ μ•μ•„λ³΄κ² μµλ‹λ‹¤.

π–‡ μ†μ¤μ½”λ“μ— λ§μ°μ¤λ¥Ό μ¬λ¦¬κ³  <span class="tip">copy</span> λ²„νΌμ„ λ„λ¥Ό κ²½μ° λ” μ‰½κ² λ³µμ‚¬ν•  μ μμµλ‹λ‹¤! 

κ¶κΈν• μ , λ³΄μ•μ  λ‚¨κ²¨μ£Όμ‹λ©΄ μ„±μ‹¤ν λ‹µλ³€ν•κ² μµλ‹λ‹¤. π <br>
\+ κ°μƒν‰ λ“κΈ€λ΅ λ‚¨κ²¨μ£Όμ‹λ©΄ νμ΄λ©λ‹λ‹¤. π™‡

### μΌλ°μ μΈ ν¬μΈν„°μ λ¬Έμ μ 
C++ μ–Έμ–΄λ” λ‹¤λ¥Έ κ°μ²΄μ§€ν–¥ μ–Έμ–΄ (e.g. JAVA, C#)μ™€ λ‹¬λ¦¬ Garbage collectorκ°€
μ΅΄μ¬ν•μ§€ μ•λ”λ‹¤. λ”°λΌμ„, μμ›κ΄€λ¦¬λ¥Ό κ°λ°μκ°€ μ§μ ‘ν•΄μ•Όλλ‹¤. κ°λ°μκ°€ μμ›μ„ μ§μ ‘
κ΄€λ¦¬ν•κ² λ  κ²½μ° μ‹¤μκ°€ μΆ…μΆ… λ°μƒν•λ©°, μ΄λ΅ μΈν•΄ *λ©”λ¨λ¦¬ λ„μ*ν„μƒμ΄ μ λ°λλ‹¤.

```cpp
#include <iostream>

using namespace std;

class Car {
  int color;

public:
  ~Car() {
    cout << "~Car()" << endl;
  }

  Go() {
    cout << "Go()" << endl;
  }
};

int main() {
  Car* p = new Car;

  p->Go();
  (*p).Go();

  // κΌ­ μμ› ν•΄μ  ν•„μ”
  //delete p;
}
```

μ„μ μ½”λ“μ™€ κ°™μ΄, `Car*`λ¥Ό μƒμ„± ν›„ `delete` μ—°μ‚°μ„ μ‚¬μ©ν•μ§€ μ•μ„ κ²½μ°
`pointer`μ— λ€ν• λ©”λ¨λ¦¬ κ³µκ°„μ€ ν”„λ΅κ·Έλ¨μ΄ *μΆ…λ£*λλ” μ‹μ κΉμ§€ μ‚¬μ©ν•  μ μ—†κ²
λλ‹¤. μ΄λ¥Ό μ°λ¦¬λ” *μμ›λ„μ ν„μƒ*μ΄λΌκ³  λ¶€λ¥΄λ©°, ν”„λ΅κ·Έλ¨μ—μ„λ” μΆ‹μ§€ μ•μ€ μν–¥μ„
λΌμΉκ² λλ‹¤. μ΄λ¥Ό λ§‰κΈ° μ„ν•΄μ„λ” κΌ­ `delete` μ—°μ‚°μ„ ν†µν•΄ κ°λ°μκ°€ μ§μ ‘ μμ›μ„
ν•΄μ ν•λ„λ΅ ν•΄μ•Όν•λ‹¤.

λν•, μ•„λμ μ½”λ“μ™€ κ°™μ΄ ν”„λ΅κ·Έλ¨ λμ΄ μ•„λ‹, μ¤‘κ°„μ— `if` μ—°μ‚°μμ™€ κ°™μ€ λ¶„κΈ°λ¬Έμ„
ν†µν• ν”„λ΅κ·Έλ¨ μΆ…λ£ν•  λ•λ„, κΌ­ *μμ› ν•΄μ *λ¥Ό ν•΄μ¤μ•Όν•λ‹¤.

```cpp
int main() {
  Car* p = new Car;

  p->Go();

	if (true) {
		// ν•΄λ‹Ή λ¶€λ¶„μ—μ„λ„ κΌ­ μμ›ν•΄μ  ν•„μ”..!
		// delete p;
		return;
	}

  (*p).Go();

	// λ³΄ν†µ μ ν•μ§€ μ•μ
  delete p;
}
```

μ΄μ™€ κ°™μ΄, μ‚¬μ©μκ°€ μ§μ ‘ λ©”λ¨λ¦¬λ¥Ό κ΄€λ¦¬ μ¦‰, ν•΄μ ν•λ„λ΅ ν•  κ²½μ° *μ‹¤μ*κ°€ λ°μƒν•  μ
μκ³ , μ΄λ΅μΈν•΄ *μμ› λ„μ ν„μƒ*μ΄ λ°μƒν•  μ μλ‹¤. λ”°λΌμ„, modern C++ μ—μ„λ”
*μ¤λ§νΈ ν¬μΈν„°*λΌλ” κ°λ…μ„ μ κ³µν•λ‹¤

### μ¤λ§νΈν¬μΈν„° μ›λ¦¬
Modern C++μ—μ„ μ κ³µν•λ” μ¤λ§νΈν¬μΈν„° κ°™μ€ κ²½μ° `<memory>` ν—¤λ”νμΌ λ‚΄ μ΅΄μ¬ν•λ©°,
ν•΄λ‹Ή ν—¤λ”νμΌμ„ μΈν΄λ£¨λ“ ν•΄μ•Ό μ‚¬μ©κ°€λ¥ν•λ‹¤.

C++ μ—μ„ μ κ³µν•κ³  μλ” μ¤λ§νΈν¬μΈν„°λ” `shared_ptr`, `weak_ptr`, `unique_ptr` μ΄
3κ°€μ§€ μ΄λ‹¤.

ν•΄λ‹Ή ν¬μ¤ν…μ—μ„λ” `shared_ptr`λ¥Ό ν™μ©ν•΄ μ¤λ§νΈν¬μΈν„°μ— λ€ν• μ›λ¦¬λ¥Ό λ‹¤λ£¨λ„λ΅
ν•λ‹¤. μ΄ν›„ ν¬μ¤ν…μ—μ„ μμ„Έν•κ² κ° ν¬μΈν„°μ κΈ°λ¥λ“¤μ΄ μ™ λ‚λ μ Έμλ”μ§€ μ•μ•„λ³΄λ„λ΅
ν•μ.

μ‚¬μ©ν•λ” λ°©λ²•μ€ μ•„λμ™€ κ°™λ‹¤.

```cpp
#include <iostream>
#include <memory>

using namespace std;

class Car {
  int color;

public:
  ~Car() {
    cout << "~Car()" << endl;
  }

  Go() {
    cout << "Go()" << endl;
  }
};

int main() {
  // Car* p = new Car;
	shared_ptr<Car> p( new Car );

  p->Go();
  (*p).Go();

  // κΌ­ μμ› ν•΄μ  ν•„μ”
  //delete p;
}
```

`shared_ptr` ν¬μΈν„°λ¥Ό μ‚¬μ©ν•κΈ° μ„ν•΄μ„λ” `memory` νμΌμ„ μΈν΄λ£¨λ“ν•΄μ•Όν•λ‹¤. λν•,
ν¬μΈν…ν•  κ°μ²΄λ¥Ό *μΈμ*λ΅ μ „λ‹¬ν•΄μ•Όν•λ‹¤. μ„μ™€ κ°™μ΄, μ½”λ“λ¥Ό μ‘μ„±ν•  κ²½μ° μ°λ¦¬λ”
μ¤λ§νΈ ν¬μΈν„°λ§ μ„ μ–Έν–λ”λ°, ν”„λ΅κ·Έλ¨ μΆ…λ£μ‹ μλ™μΌλ΅ `~Car()` μ†λ©Έμκ°€ λ¶λ¦¬λ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

μ•„λμ κ·Έλ¦Όμ„ ν†µν•΄ μ–΄λ–»κ² ν¬μΈν„°κ°€ λ‚΄λ¶€μ μΌλ΅ *μ κ±°* λ  μ μλ”μ§€λ¥Ό ν™•μΈν•΄λ³΄μ.

![sptr1](/assets/img/sptr1.png)

μ„μ κ·Έλ¦Όκ³Ό κ°™μ΄, μ°λ¦¬λ” `shared_ptr`λ¥Ό μƒμ„±ν•  λ•, `type` κ°’μ„ `Car`λ΅ μ§€μ •ν•κ³ ,
	μΈμλ΅ `Car` κ°μ²΄λ¥Ό μ „λ‹¬ν•λ‹¤. `shared_ptr` λ‚΄λ¶€μ—λ” μ „λ‹¬λ `type`κ°’μ— ν•΄λ‹Ήλλ”
	ν¬μΈν„°κ°€ μ΅΄μ¬ν•λ©°, ν•΄λ‹Ή ν¬μΈν„°λ” μ „λ‹¬λ°›μ€ μΈμκ°’μ„ κ°€λ¦¬ν‚¤λ„λ΅ ν•λ‹¤.

μ¤λ§νΈν¬μΈν„°λ¥Ό μ‚¬μ©ν•κ³ , μ†ν•΄μλ” ν•¨μκ°€ μ κ±°λ  κ²½μ° `shared_ptr`μ μ†λ©Έμκ°€
λ¶λ¦¬κ² λλ©°, μ†λ©Έμ λ‚΄μ—μ„ λ‚΄λ¶€μ μΌλ΅ κ°–κ³  μλ ν¬μΈν„°λ¥Ό `delete`μ—°μ‚°μ„ ν†µν•΄
μ κ±°ν•λ„λ΅ ν•λ‹¤.

*κ·Έλ ‡λ‹¤λ©΄ μΌλ°μ μΈ ν¬μΈν„°μ™€ κ°™μ΄ μ¤λ§νΈν¬μΈν„°μ—μ„λ” μ–΄λ–»κ² `->` λ™μ‘κ³Ό `\*` λ™μ‘μ„
μ‚¬μ©ν•  μ μμ„κΉ? π¤”*

κ·Έ μ΄μ λ” μ¤λ§νΈν¬μΈν„° κ°μ²΄λ‚΄μ—μ„ `operator->()` μ—°μ‚°μμ™€ `operator*()` μ—°μ‚°μλ¥Ό μ¬μ •μν–κΈ° λ•λ¬Έμ—λ‹¤. κ°„λ‹¨ν μƒκ°ν•΄λ³΄λ©΄ μ•„λμ™€ κ°™μ΄ κµ¬ν„λμ–΄μ Έ μμ„ κ²ƒ κ°™λ‹¤.

```cpp
class shared_ptr{
	T* type;
	...

public:
		~shared_ptr() {
			delete type;
		}

		T* operator->() {
			return type;
		}

		T operator*() {
			return *type;
		}
		...
};
```

μ•„λ§ μ΄λ° λ¨μµμΌλ΅ μ¬μ •μ λμ–΄ μμ§€ μ•μ„κΉ μƒκ°ν•΄λ³Έλ‹¤.

κ°„λ‹¨ν•κ² λ™μ‘μ›λ¦¬λ¥Ό μ•μ•„λ³΄μ•λ”λ°, κ·Έλ ‡λ‹¤λ©΄ μ™ C++μ—μ„λ” 3κ°€μ§€ νƒ€μ…μΌλ΅
μ¤λ§νΈν¬μΈν„°λ¥Ό λ‚λ μ„ μ κ³µν•΄μ¤„κΉ?

κ·Έ μ΄μ μ— λ€ν•΄μ„λ” λ‹¤λ¥Έ ν¬μ¤ν…μ„ ν†µν•΄ μ•μ•„λ³΄μ!

### Reference
[C++ κ°•μ](https://www.ecourse.co.kr/)

