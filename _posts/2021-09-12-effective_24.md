---
layout: post
author: doodoo
title: "[Effective C++] ν•­λ© 18: μΈν„°νμ΄μ¤ μ„¤κ³„λ” μ λ€λ΅ μ“°κΈ°μ—” μ‰½κ², μ—‰ν„°λ¦¬λ΅
μ“°κΈ°μ—” μ–΄λ µκ² ν•μ(2)"
subtitle: "μ„¤κ³„ λ° μ„ μ–Έ π”"
date: 2021-09-12
cover: /assets/img/default.png
tags: Effective_C++ C++
sitemap :
 changefreq : daily
 priority : 1.0
---
μ•λ…•ν•μ„Έμ”! <span class="doodoo">λ‘λ‘μ½”λ”©</span> μ…λ‹λ‹¤ β‹ <br>
μ¤λμ€ μΆ‹μ€ μΈν„°νμ΄μ¤ λ§λ“¤κΈ°μ— λ€ν•΄ μ•μ•„λ³΄κ² μµλ‹λ‹¤.

[μ΄μ „ ν¬μ¤ν…](https://0xd00d00.github.io/2021/09/05/effective_23.html)μ„ μ°Έκ³ ν•λ©΄ λ‚΄μ©μ΄ν•΄κ°€ ν›¨μ”¬ μμ›”ν•©λ‹λ‹¤!

π–‡ μ†μ¤μ½”λ“μ— λ§μ°μ¤λ¥Ό μ¬λ¦¬κ³  <span class="tip">copy</span> λ²„νΌμ„ λ„λ¥Ό κ²½μ° λ” μ‰½κ² λ³µμ‚¬ν•  μ μμµλ‹λ‹¤!

κ¶κΈν• μ , λ³΄μ•μ  λ‚¨κ²¨μ£Όμ‹λ©΄ μ„±μ‹¤ν λ‹µλ³€ν•κ² μµλ‹λ‹¤. π <br>
\+ κ°μƒν‰ λ“κΈ€λ΅ λ‚¨κ²¨μ£Όμ‹λ©΄ νμ΄λ©λ‹λ‹¤. π™‡

### μ‚¬μ©μ μ½μ—μ„ λ­”κ°€λ¥Ό μ™Έμ›μ•Ό μ λ€λ΅ μ“Έ μ μλ” μΈν„°νμ΄μ¤λ” μλ»μ“°κΈ° μ‰½λ‹¤
μ‚¬μ©μ μ½μ—μ„ μ™Έμ›μ„ μ‚¬μ©ν•λ„λ΅ λ§λ“¤λ©΄ μ‚¬μ©μκ°€ μλ» μ‚¬μ©ν•κΈ° μ‰¬μ›μ§„λ‹¤.

```cpp
// factory ν•¨μλΌ κ°€μ •
Investment* createInvestment();
```

μ„μ ν•¨μλ¥Ό μ‚¬μ©ν•  λ•, μμ› λ„μ¶μ„ ν”Όν•κΈ° μ„ν•΄ `createInvestment`μ—μ„ μ–»μ€
ν¬μΈν„°λ¥Ό λ‚μ¤‘μ— μ‚­μ ν•΄μ•Όν•λ‹¤. ν•μ§€λ§ μ„μ™€ κ°™μ΄ ν•¨μλ¥Ό κµ¬μ„±ν•  κ²½μ° μ‚¬μ©μκ°€ μ‹¤μλ΅ μμ›μ„ ν•΄μ ν•μ§€ μ•μ•„ μμ›
λ„μκ°€ λ°μƒν•  μ μκ±°λ‚ λ‘κ°™μ€ ν¬μΈν„°μ— λ€ν•΄ `delete`κ°€ λ‘ λ²μΌμ–΄ λ‚  μ μλ‹¤.

[μ΄μ „ ν¬μ¤ν…](https://0xd00d00.github.io/2021/08/17/effective_18.html)μ„ ν†µν•΄ `auto_ptr` λλ” `tr1::shared_ptr`λ¥Ό ν• λ‹Ή λ°›μ•„ ν•΄λ‹Ή
ν¬μΈν„°λ¥Ό μ§μ ‘ μ‚­μ ν•λ” κ²ƒμ΄ μ•„λ‹λΌ *μ¤λ§νΈν¬μΈν„°*λ¥Ό ν†µν•΄ μ‚­μ ν•λ„λ΅ κµ¬μ„±ν–λ‹¤.
ν•μ§€λ§ μ΄λ° *μ¤λ§νΈν¬μΈν„°*λ¥Ό λ§λ“ λ‹¤λ” κ²ƒμ„ μμ–΄λ¨Ήκ³  ν”„λ΅κ·Έλ¨μ„ μ™„μ„±ν•κ² λλ©΄
μ–΄λ–»κ² λ κΉ? κ³ μΉκΈ°κ°€ νλ“¤μ–΄μ§„λ‹¤. λ”°λΌμ„, μΈν„°νμ΄μ¤λ¥Ό λ§λ“¤λ• λ¶€ν„°
*μ¤λ§νΈν¬μΈν„°*λ¥Ό λ°ν™ν•λ„λ΅ ν•΄ μ‚¬μ©μμ—κ² μ‚¬μ©ν•λ„λ΅ μ§€μ‹ν•λ” κ²ƒμ΄ μΆ‹μ€
μΈν„°νμ΄μ¤ μ„¤κ³„λ°©λ²•μ΄λ‹¤.

```cpp
std::tr1::shared_ptr<Investment> createInvestment();
```

μ„μ™€ κ°™μ΄, μ›μ‹ν¬μΈν„°λ¥Ό λ°ν™λ°›λ” κ²ƒμ΄ μ•„λ‹λΌ, *μ¤λ§νΈν¬μΈν„°*λ¥Ό λ°ν™λ°›λ„λ΅
κµ¬μ„±ν•΄λ‘λ©΄ μ‚¬μ©μκ°€ κΉλΉ΅ν•κ³ , *μ¤λ§νΈν¬μΈν„°*λ¥Ό μ•λ§λ“¤μ–΄ μμ› λ„μλ¥Ό ν•λ”
μΌ€μ΄μ¤λ¥Ό λ°°μ μ‹ν‚¬ μ μλ‹¤.

μ‚¬μ‹¤ *tr1::shared_ptr*λ¥Ό λ°ν™ν•λ” κµ¬μ΅°λ” *μμ› λ„μ*λ¥Ό λ§‰λ” κ²ƒ λΏ μ•„λ‹λΌ
μƒλ‹Ήμμ μ‚¬μ©μ μ‹¤μλ¥Ό μ‚¬μ „ λ΄‰μ‡„ ν•  μ μλ” μ¥μ μ΄ μλ‹¤. λ³ΈμΈμ΄ μΈν„°νμ΄μ¤
μ„¤κ³„μλΌλ©΄ μ κ·Ή κΈ°μ©ν•λ„λ΅ ν•μ!π™„

### tr1::shared_ptr νΉμ§•
μ΄μ•ΌκΈ°κ°€ λ‚μ¨ κΉ€μ—, tr1::shared_ptrμ λ‡ κ°€μ§€ νΉμ§•μ„ μ•μ•„λ³΄μ. νΉμ§•μ„
μ•μ•„λ³΄λ©΄μ„, μ‹¤μ  μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•  λ•, μ™ ν•΄λ‹Ή μ¤λ§νΈ ν¬μΈν„°λ¥Ό μ΄μ©ν•λ©΄ μΆ‹μ€μ§€
μ‚΄ν΄λ³΄λ„λ΅ ν•μ.

μ°λ¦¬κ°€ μ•μ„ μ΄μ•ΌκΈ° ν–λ“―, shared_ptrμ„ μ΄μ©ν•  κ²½μ° *μμ›ν•΄μ * κ΄€λ ¨ν•μ—¬ λ°μƒν•λ”
λ¬Έμ λ¥Ό μ‚¬μ „μ— λ§‰μ„ μ μλ‹¤. λν•, μ‚­μ μλ¥Ό μ§€μ •ν•  μ μμ–΄, κΌ­ `delete`λ§
μ‚¬μ©ν•λ” κ²ƒμ΄ μ•„λ‹ `delete`λ¥Ό μ»¤μ¤ν…€ ν•  μ μλ‹¤λ” μ¥μ μ΄ μλ‹¤. μλ¥Όλ“¤μ–΄,
	`createInvsetment`λ¥Ό ν†µν•΄ `Investment*`λ¥Ό μ§μ ‘ `delete`λ¥Ό ν†µν•΄ μ‚­μ ν•μ§€ μ•κ³ ,
	`getRidOfInvestment`λΌλ” ν•¨μλ¥Ό λ§λ“¤μ–΄ `share_ptr`μ μ‚­μ μλ΅ μ§€μ •ν•  κ²½μ°,
	μμ›ν•΄μ  μ§€μ •λ ν•¨μλ¥Ό νΈμ¶ν•λ„λ΅ λ³€κ²½ν•  μ μλ‹¤.

ν•΄λ‹Ή λ°©λ²•μ„ μ‚¬μ©ν•  λ•, μ¤λ§νΈ ν¬μΈν„°λ¥Ό λ°ν™ν•  λ•, μ‚­μ μκ°€ μ§€μ •λ μ¤λ§νΈ
ν¬μΈν„°λ¥Ό λ°ν™ν•΄μ•Όν•λ‹¤λ” μ μ΄λ‹¤. κ·Έλ ‡μ§€ μ•μ„ κ²½μ°, μΌλ°μ μΌλ΅ μ‚¬μ©ν•λ” `delete`λ¥Ό
νΈμ¶ν•  μλ„ μκΈ° λ•λ¬Έμ΄λ‹¤.

μ•„λμ™€ κ°™μ΄, ν•¨μ λ‚΄μ—μ„ `shared_ptr`λ¥Ό μ„ μ–Έν•κ³ , μ‚­μ μκ°€ μ§€μ •λ ν•΄λ‹Ή κ°’μ„ λ°ν™ν•λ„λ΅ ν•΄μ•Όν•λ‹¤.

```cpp
std::tr1::shared_ptr<Investment> createInvestment() {
	std::tr1::shared_ptr<Investment>
		pInv (0, getRidOfInvestment);

	pInv = ...;

	return pInv;
}
```

μ„μμ½”λ“λ¥Ό μν–‰ν•  κ²½μ° μ„ μ–Έλ¶€λ¶„μ—μ„ μ»΄νμΌ μ—λ¬κ°€ λ°μƒν•λ‹¤.
`tr1::shared_ptr`μ—μ„ μ²«λ²μ§Έ μΈμλ” "ν¬μΈν„°"λ¥Ό μ „λ‹¬λ°›λ„λ΅ ν•΄μ•Όν•λ‹¤. 0 μΌ κ²½μ°
`int`ν• νƒ€μ…μ΄λ‹¤. λ¬Όλ΅  μ•”μ‹μ μΌλ΅ `null` ν¬μΈν„°λ΅ μ „λ‹¬λ°›μ„ μ μμ§€λ§ `shared_ptr` κ°™μ€ κ²½μ° μ•”μ‹μ  ν• λ³€ν™μ΄ λ¶κ°€λ¥ ν•κΈ° λ•λ¬Έμ— `Investment*` νƒ€μ…μ„ μ „λ‹¬ν•΄μ•Όν•λ‹¤. μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄μ„λ” `static_cast`λ¥Ό ν†µν•΄ ν•λ³€ν™μΌλ΅ ν•΄λ‹Ή κ°’μ„ `Investment*` νƒ€μ…μΌλ΅ λ³€ν™ν•΄μ£Όμ–΄μ•Όν•λ‹¤. `satic_cast` κ°™μ€ κ²½μ° ν›„μ— μΆ€ λ” μμ„Έν λ‹¤λ£¨λ„λ΅ ν•μ.

```cpp
std::tr1::shared_ptr<Investment> createInvestment() {
	std::tr1::shared_ptr<Investment> pInv (static_cast<Investment*>(0),
																				 getRidOfInvestment);

	pInv = ...;

	return pInv;
}
```

μ„μ μ½”λ“μ™€ κ°™μ΄ μ‘μ„±ν•κ² λλ©΄ μ»΄νμΌ μ—λ¬ μ—†μ΄ μ •μƒλ™μ‘ν•λ” κ²ƒμ„ ν™•μΈν•  μ
μλ‹¤.

`tr1::shared_ptr`μ„ μ‚¬μ©ν•λ” νΉμ§• μ¤‘ κ°€μ¥ μΆ‹μ€ νΉμ§•μ€ *κµμ°¨ DLL λ¬Έμ *λ¥Ό λ§‰μ„ μ
μλ‹¤λ” μ μ΄λ‹¤.

κ°μ²΄ μƒμ„± μ‹, μ–΄λ–¤ DLLμ„ ν™μ©ν•΄ newλ¥Ό μ‚¬μ©ν•  κ²½μ° κΈ°μ΅΄μ— μ‚¬μ©ν•λ DLLμ
`delete`κ°€ μ•„λ‹ λ‹¤λ¥Έ DLLμ `delete`λ¥Ό μ‚¬μ©ν•λ” κ²½μ°λ¥Ό *κµμ°¨ DLL λ¬Έμ *λΌκ³  ν•λ‹¤.
μ°λ¦¬κ°€ `tr1::shared_ptr`λ¥Ό ν™μ©ν•λ©΄, ν•΄λ‹Ή λ¬Έμ  μ—†μ΄ `new`λ¥Ό μ²μ μ‚¬μ©ν–λ
DLLμ—μ„ λ¬΄μ΅°κ±΄ `delete`λ¥Ό μ‚¬μ©ν•λ„λ΅ κµ¬ν„λμ–΄μ Έ μλ‹¤. (μ¦‰, tr1::shared_ptrλ¥Ό
		μ κ·Ή μ‚¬μ©ν•λΌ.)

<span class="tip">Tip</span> DLLμ΄λ€ Dynamically Linked Libraryμ μ¤„μ„λ§λ΅, λ™μ 
λ§ν¬ λΌμ΄λΈλ¬λ¦¬λΌκ³  λ¶€λ¥Έλ‹¤. μ°λ¦¬κ°€ μΌλ°μ μΌλ΅ Libraryλ¥Ό μ‚¬μ©ν•κΈ° μ„ν•΄ lib
νμΌλ“¤μ„ μ†μ¤ μ½”λ“λ‚΄ μ¶”κ°€ν•λ” κ²ƒμ΄ μ•„λ‹λΌ, λ©”λ¨λ¦¬ μ©λ‰μ„ μ¤„μ΄κΈ° μ„ν•΄ μ„μΉλ¥Ό μ•λ ¤μ£Όκ³  ν•΄λ‹Ή μ„μΉμ—μ„
libraryμ— μ ‘κ·Όν•λ„λ΅ ν•λ‹¤.

### To Sum Up
π‘‰ μΆ‹μ€ μΈν„°νμ΄μ¤λ” μ λ€λ΅ μ“°κΈ°μ— μ‰¬μ°λ©° μ—‰ν„°λ¦¬λ΅ μ“°κΈ°μ— μ–΄λ µκ² λ§λ“λ” κ²ƒμ΄λ‹¤.

π‘‰ μΈν„°νμ΄μ¤μ μ¬λ°”λ¥Έ μ‚¬μ©μ„ μ΄λ„λ” λ°©λ²•μΌλ΅λ” μΈν„°νμ΄μ¤ μ‚¬μ΄μ μΌκ΄€μ„±
μ΅μ•„μ£ΌκΈ°, κΈ°λ³Έμ κ³µ νƒ€μ…κ³Όμ λ™μ‘ νΈν™μ„± μ μ§€ν•κΈ°κ°€ μ΅΄μ¬ν•λ‹¤.

π‘‰ μ‚¬μ©μ μ‹¤μλ¥Ό λ°©μ§€ν•λ” λ°©λ²•μΌλ΅λ” μƒλ΅μ΄ νƒ€μ… λ§λ“¤κΈ°, νƒ€μ…μ— λ€ν• μ—°μ‚°μ„
μ ν•ν•κΈ°, κ°μ²΄μ κ°’μ— λ€ν•΄ μ μ•½κ±ΈκΈ°, μμ› κ΄€λ¦¬ μ‘μ—…μ„ μ‚¬μ©μ μ±…μ„μΌλ΅ λ†“μ§€
μ•κΈ°κ°€ μλ‹¤.

π‘‰ tr1::shared_ptrμ€ μ‚¬μ©μ μ •μ μ‚­μ μλ¥Ό μ§€μ›ν•λ‹¤. ν•΄λ‹Ή νΉμ§• λ•λ¬Έμ— κµμ°¨ DLL
λ¬Έμ λ¥Ό λ§‰μ„ μ μλ‹¤.
